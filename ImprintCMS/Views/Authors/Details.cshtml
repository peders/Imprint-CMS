@model PersonPage
@{
    ViewBag.Title = Model.Person.FullName;
}
<div id="image">
    @if (Model.Person.SmallImageId != null)
    {
        @Html.PersonImage(Model.Person)
        if (!String.IsNullOrWhiteSpace(Model.Person.PhotographerCredit))
        {
        <p class="photographer">@String.Format(SitePhrases.LabelPhotoCredit, Model.Person.PhotographerCredit)</p>
        }
        if (Model.Person.LargeImageId != null)
        {
        <p class="download">@Html.ImageDownload(Url.Action("display", "upload", new { category = Model.Person.UploadedFile1.Category, fileName = Model.Person.UploadedFile1.FileName }), SitePhrases.LabelLargePortrait, ((SiteConfig)ViewBag.Config).PersonImageDownloadNotice)</p>
        }
    }
</div>
<div id="main">
    <h1>@Model.Person.FullName</h1>
    @if (!String.IsNullOrWhiteSpace(Model.Person.Description))
    {
        @Model.Person.Description.ToRichText()
    }
    @foreach (var booksByRole in Model.Books.GroupBy(b => b.Relations.Single(r => r.PersonId == Model.Person.Id).Role).Where(r=> r.Key.ShowBookList).OrderBy(r => r.Key.SequenceIdentifier))
    { 
        <h2>@(!String.IsNullOrWhiteSpace(booksByRole.Key.BookListHeading) ? booksByRole.Key.BookListHeading : booksByRole.Key.Name)</h2>
        <ul>
            @foreach (var book in booksByRole.OrderBy(b => b.CachedReleaseYear))
            {
                <li>@Html.BookPersonPageEntry(book)</li>
            }
        </ul>
    }
    @if (!String.IsNullOrWhiteSpace(Model.Person.Awards))
    {
        <h2>@SitePhrases.HeadingAuthorAwards</h2>
        @Model.Person.Awards.ToRichText()
    }
    @if (!String.IsNullOrWhiteSpace(Model.Person.Translations))
    {
        <h2>@SitePhrases.HeadingAuthorTranslations</h2>
        @Model.Person.Translations.ToRichText()
    }
    @if (!String.IsNullOrWhiteSpace(Model.Person.Anthologies))
    {
        <h2>@SitePhrases.HeadingAuthorAnthologies</h2>
        @Model.Person.Anthologies.ToRichText()
    }
    @if (Model.Person.PersonToArticles.Any(a => a.Article.IsVisible))
    {
        <h2>@String.Format(SitePhrases.HeadingArticlesAbout, Model.Person.FullName)</h2>
        <ul>
            @foreach (var article in Model.Person.PersonToArticles.Where(a => a.Article.IsVisible).Select(a => a.Article).OrderByDescending(a => a.Date))
            {
                <li>@Html.ActionLink(article.Title, "article", "home", new { id = article.Id }, null)
                    @String.Format("{0:D}", article.Date)</li>
            }
        </ul>
    }
</div>
