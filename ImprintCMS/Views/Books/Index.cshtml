@model BookCatalog
@{
    ViewBag.Title = Model.Title;
}
<ul id="genremenu">
    <li>@(Model.CurrentGenre == null ? new HtmlString("<strong>" + SitePhrases.LabelAllBooks + "</strong>") : Html.ActionLink(SitePhrases.LabelAllBooks, "index", new { id = UrlParameter.Optional }, null))</li>
    @foreach (var genre in Model.Genres)
    {
        <li>@(genre == Model.CurrentGenre ? new HtmlString("<strong>" + genre.Name + "</strong>") : Html.ActionLink(genre.Name, "index", new { id = genre.Id }))</li>
    }
</ul>
<div id="booklisting">
    @foreach (var group in Model.CurrentBooks.OrderByDescending(b => b.HasRightsHolders).ThenBy(b => b.RightsHoldersDisplay).ThenBy(b => b.ReleaseYear).GroupBy(b => b.RightsHoldersDisplay))
    {
        <div class="book">
            <h2>@if (group.First().HasRightsHolders)
                {
                    foreach (var relation in group.First().RightsHolders)
                    {
                @(relation.Person.HasPage ? Html.ActionLink(relation.ReversePersonName, "details", "authors", new { id = relation.PersonId }, null) : new HtmlString(relation.ReversePersonName))
                        if (relation != group.First().RightsHolders.Last())
                        {
                @(" / ")
                        }
                    }
                }
                else
                {
                @group.Key
                }
            </h2>
            <ul>
                @foreach (var book in group)
                {
                    <li>
                        @if (book.CoverEdition != null)
                        {
                            <a href="@book.Url">@Html.CoverImage(book.CoverEdition)</a>
                        }
                        <a href="@book.Url">@book.Title</a>
                        @if (!String.IsNullOrWhiteSpace(book.Subtitle))
                        {
                            <br />
                            <span class="subtitle">@book.Subtitle</span>
                        }
                        <br />
                        <br />
                        <span class="releaseyear">@book.ReleaseYear</span>
                    </li>
                }
            </ul>
        </div>
    }
</div>
